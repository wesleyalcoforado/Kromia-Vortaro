<html>
<head>
	<title>Vortaro</title>
	<style>
		dt {
			font-weight: bold;
		}
		
		dt .detaloj {
			font-weight: normal;
			color: blue;
		}
	</style>
</head>
<script type="text/javascript">
	function serchi(){
		var vorto = document.getElementById('vorto').value;
		if(vorto == null || vorto.trim().length == 0){
			return;
		}

		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function(datumoj) {
			if (xhr.readyState == 4) {
				if (xhr.status == 200) {
					var datumoj = xhr.responseText;
					aranghi(datumoj);
				} else {
					aranghi(null);
				}
			}
		}  
		
		var delingvo = localStorage.deLingvo.toLowerCase();
		var allingvo = localStorage.alLingvo.toLowerCase();

		var url = 'http://www.lernu.net/cgi-bin/serchi.pl?modelo='+vorto+'&delingvo='+delingvo+'&allingvo='+allingvo;
		xhr.open('GET', url, true);
		xhr.send();  	
	}
  
	function aranghi(datumoj){
		var divTraduko = document.getElementById('traduko');
		divTraduko.innerHTML = '';
			
		if(vortoTrovata(datumoj)){
			var rikordoj = datumoj.split('\n');
			var tradukota = rikordoj[0].split('\t');
			var tradukotaVorto = tradukota[1];
			var silaboj = tradukota[2];
			var radiko = tradukota[3];
			
			if(silaboj.trim().length > 0){
				silaboj = silaboj.replace(/\//g, '·');
				tradukotaVorto = tradukotaVorto + " <span class='detaloj'>(" + silaboj;
				if(radiko.trim().length > 0){
					tradukotaVorto = tradukotaVorto + ' ← '+ radiko;
				}
				tradukotaVorto = tradukotaVorto + ')</span>';
			}
			
			var tradukita = rikordoj[1].split('\t');
			var tradukitajVortoj = tradukita[3].replace('&gt;', '»').replace('>', '»').split(';');

			var dl = document.createElement('dl');
			var dt = document.createElement('dt');
			dt.innerHTML = tradukotaVorto;
			
			dl.appendChild(dt);

			for(var v in tradukitajVortoj){
				var dd = document.createElement('dd');
				dd.innerText = tradukitajVortoj[v];
				dl.appendChild(dd);
			}

			divTraduko.appendChild(dl);
		}else{
			divTraduko.innerText = "Vorto ne trovata";
		}
	}
  
	function vortoTrovata(datumoj){
		return	(datumoj != null) &&
				(datumoj.indexOf("\n") != -1);
	}
	
	function shanghiLingvojn(){
		var delingvo = document.getElementById('delingvo');
		var allingvo = document.getElementById('allingvo');
		
		var helpo = delingvo.innerHTML;
		delingvo.innerHTML = allingvo.innerHTML;
		allingvo.innerHTML = helpo;
		
		localStorage.deLingvo = delingvo.innerHTML;
		localStorage.alLingvo = allingvo.innerHTML;
	}
	
	function reshargi(){
		if(localStorage.deLingvo == null && localStorage.alLingvo == null){
			localStorage.deLingvo = "EO";
			localStorage.alLingvo = "PT";
		}
		
		var delingvo = document.getElementById('delingvo');
		var allingvo = document.getElementById('allingvo');
		
		delingvo.innerHTML = localStorage.deLingvo;
		allingvo.innerHTML = localStorage.alLingvo;
	}
  
</script>

<body onload="reshargi()">

<form onsubmit="return false;">
	<table>
		<tr>
			<td colspan="2">
				<div align="center">
					<span id="delingvo">EO</span>
					<img src="action_refresh.gif" onclick="shanghiLingvojn()">
					<span id="allingvo">PT</span>
				</div>
			</td>
		</tr>
		<tr>
			<td><input type="text" id="vorto"></td>
			<td><input type="submit" onclick="serchi()" value="Serĉi"></td>
		</tr>
		<tr>
			<td colspan="2">
				<div id="traduko"></div>
			</td>
		</tr>
	</table>
</form>



</body>
</html>