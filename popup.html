<html>
<head>
	<title>Vortaro</title>
	<style>
		@import url(http://fonts.googleapis.com/css?family=Ubuntu&v2);
		
		* {
			font-family: 'Ubuntu', sans-serif;
			font-size: 10pt;
		}
		
		img {
			vertical-align: text-bottom;
		}
	
		dt {
			font-weight: bold;
		}
		
		dt .detaloj {
			font-weight: normal;
			color: blue;
		}
		
		#traduko {
			padding: 5px 0;
		}
	</style>
</head>
<script type="text/javascript">
	function serchi(){
		var vorto = document.getElementById('vorto').value;
		if(vorto == null || vorto.trim().length == 0){
			return;
		}

		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function(datumoj) {
			if (xhr.readyState == 4) {
				if (xhr.status == 200) {
					var datumoj = xhr.responseText;
					aranghi(datumoj);
				} else {
					aranghi(null);
				}
			}
		}  
		
		var delingvo = "eo";
		var allingvo = localStorage.lingvo;
		
		if(localStorage.direkto == "maldekstre"){
			delingvo = localStorage.lingvo;
			allingvo = "eo";
		}
		

		var url = 'http://www.lernu.net/cgi-bin/serchi.pl?modelo='+vorto+'&delingvo='+delingvo+'&allingvo='+allingvo;
		xhr.open('GET', url, true);
		xhr.send();
		montriSxargxbildon();
	}
  
	function aranghi(datumoj){
		var divTraduko = document.getElementById('traduko');
		divTraduko.innerHTML = '';
			
		if(vortoTrovata(datumoj)){
			var rikordoj = datumoj.split('\n');
			var tradukota = rikordoj[0].split('\t');
			var tradukotaVorto = tradukota[1];
			var silaboj = tradukota[2];
			var radiko = tradukota[3];
			
			if(silaboj.trim().length > 0){
				silaboj = silaboj.replace(/\//g, '·');
				tradukotaVorto = tradukotaVorto + " <span class='detaloj'>(" + silaboj;
				if(radiko.trim().length > 0){
					tradukotaVorto = tradukotaVorto + ' ← '+ radiko;
				}
				tradukotaVorto = tradukotaVorto + ')</span>';
			}
			
			var tradukita = rikordoj[1].split('\t');
			var tradukitajVortoj = tradukita[3].replace('&gt;', '»').replace('>', '»').split(';');

			var dl = document.createElement('dl');
			var dt = document.createElement('dt');
			dt.innerHTML = tradukotaVorto;
			
			dl.appendChild(dt);

			for(var v in tradukitajVortoj){
				var dd = document.createElement('dd');
				dd.innerText = tradukitajVortoj[v];
				dl.appendChild(dd);
			}

			divTraduko.appendChild(dl);
		}else{
			divTraduko.innerText = "Vorto ne trovata";
		}
	}
  
	function vortoTrovata(datumoj){
		return	(datumoj != null) &&
				(datumoj.indexOf("\n") != -1);
	}
	
	function shanghiDirekton(){
		var bildoDirekto = document.getElementById('direkto');
		
		if(localStorage.direkto == "dekstre"){
			localStorage.direkto = "maldekstre";
			bildoDirekto.src = "sago_maldekstre.png";
		}else{
			localStorage.direkto = "dekstre"
			bildoDirekto.src = "sago_dekstre.png";
		}
	}
	
	function reshargi(){
		if(localStorage.lingvo == null){
			localStorage.lingvo = "pt";
		}
		
		var lingvo = document.getElementById('lingvo');
		for(var i=0; i<lingvo.options.length; i++){
			if(lingvo.options[i].value == localStorage.lingvo){
				lingvo.selectedIndex = i;
				break;
			}
		}
		
		if(localStorage.direkto == null || localStorage.direkto == "dekstre"){
			localStorage.direkto = "dekstre";
		}else{
			var bildoDirekto = document.getElementById('direkto');
			bildoDirekto.src = "sago_maldekstre.png";
			localStorage.direkto = "maldekstre";
		}
		
		enfokusigiTekstujon();
	}
	
	function enfokusigiTekstujon(){
		document.getElementById('vorto').focus();
	}
	
	function aktualigiLingvon(){
		var lingvo = document.getElementById('lingvo');
		localStorage.lingvo = lingvo.options[lingvo.selectedIndex].value;
	}
	
	function montriSxargxbildon(){
		
		var ajax = document.createElement('img');
		ajax.src = "ajax.gif";
		var div = document.createElement('div');
		div.align = "center";
		div.appendChild(ajax);
		
		document.getElementById("traduko").innerHTML = '';
		document.getElementById("traduko").appendChild(div);
	}

	function xAlUtf8(t,el) {
		if (document.getElementById("x").checked) {
			t = t.replace(/c[xX]/g, "\u0109");
			t = t.replace(/g[xX]/g, "\u011d");
			t = t.replace(/h[xX]/g, "\u0125");
			t = t.replace(/j[xX]/g, "\u0135");
			t = t.replace(/s[xX]/g, "\u015d");
			t = t.replace(/u[xX]/g, "\u016d");
			t = t.replace(/C[xX]/g, "\u0108");
			t = t.replace(/G[xX]/g, "\u011c");
			t = t.replace(/H[xX]/g, "\u0124");
			t = t.replace(/J[xX]/g, "\u0134");
			t = t.replace(/S[xX]/g, "\u015c");
			t = t.replace(/U[xX]/g, "\u016c");
			if (t != document.getElementById(el).value) {
				document.getElementById(el).value = t;
			}
		}
	}
  
</script>

<body onload="reshargi()">

<form onsubmit="return false;">
	<table>
		<tr>
			<td colspan="2">
				<div align="center">
					EO
					<img src="sago_dekstre.png" id="direkto" onclick="shanghiDirekton()">
					<select id="lingvo" onchange="aktualigiLingvon()"> 
						<option value="eo">Esperanto</option> 
						<option value="en">English</option> 
						<option value="ar">عربي</option> 
						<option value="bg">Български</option> 
						<option value="cs">Čeština</option> 
						<option value="zh">中文</option> 
						<option value="da">Dansk</option> 
						<option value="fi">Suomi</option> 
						<option value="fr">Français</option> 
						<option value="de">Deutsch</option> 
						<option value="el">Ελληνικά</option> 
						<option value="he">עברית</option> 
						<option value="hi">हिन्दी</option> 
						<option value="es">Español</option> 
						<option value="hu">Magyar</option> 
						<option value="ga">Gaeilge</option> 
						<option value="it">Italiano</option> 
						<option value="ja">日本語</option> 
						<option value="ca">Català</option> 
						<option value="ko">한국어</option> 
						<option value="hr">Hrvatski</option> 
						<option value="lt">Lietuvių</option> 
						<option value="nl">Nederlands</option> 
						<option value="no">Norsk</option> 
						<option value="fa">فارسی</option> 
						<option value="pl">Polski</option> 
						<option value="pt">Português</option> 
						<option value="ro">Română</option> 
						<option value="ru">Русский</option> 
						<option value="sr">Српски</option> 
						<option value="sk">Slovenčina</option> 
						<option value="sl">Slovensko</option> 
						<option value="hsb">Hornjoserbsce</option> 
						<option value="sw">Kiswahili</option> 
						<option value="sv">Svenska</option> 
						<option value="th">ไทย</option> 
						<option value="tr">Türkçe</option> 
						<option value="uk">Українська</option> 
						<option value="vi">Việt nam</option> 
					</select> 					
				</div>
			</td>
		</tr>
		<tr>
			<td><input type="text" id="vorto" onKeyUp="xAlUtf8(this.value,'vorto')"></td>
			<td><input type="submit" onclick="serchi()" value="Serĉi"></td>
		</tr>
		<tr>
			<td colspan="2">
				anstataŭigu  cx, gx, ..., ux <input type="checkbox" name="x" id="x" onClick="xAlUtf8(document.getElementById('vorto').value,'vorto')" checked="checked">
			</td>
		</tr>
		<tr>
			<td colspan="2">
				<div id="traduko"></div>
			</td>
		</tr>
	</table>
</form>



</body>
</html>
